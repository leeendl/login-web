<!DOCTYPE html>
<html lang="en" style="background-color: rgba(0,0,0,0.0); width:100%; height: 100%;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Growtopia Player Support</title>
    <link rel="icon" type="image/png" href="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/assets/images/growtopia.ico" sizes="16x16">
    <link rel="stylesheet" media="all" href="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/assets/css/faq-main.css">
    <link rel="stylesheet" media="all" href="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/assets/css/shop-custom.css">
    <link rel="stylesheet" media="all" href="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/assets/css/ingame-custom.css">
    <style>
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .modal-backdrop + div {
            overflow: auto;
        }
        .modal-body, .content {
            padding: 0;
        }
    </style>
</head>
<body style="background-color: rgba(0,0,0,0.0);">
<button type="button" class="btn btn-primary hidden" data-toggle="modal" id="modalButton" data-target="#modalShow" data-backdrop="static" data-keyboard="false"></button>
<div class="content">
    <section class="common-box">
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="row">
                        <div class="modal fade product-list-popup" id="modalShow" tabindex="-1" role="dialog" aria-hidden="false">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="content">
                                            <section class="common-box">
                                                <div class="container">
                                                    <div class="section-title center-align">
                                                        <h2>Log in with your Grow ID</h2>
                                                    </div>
                                                    <div class="text-danger text-danger-wrapper" id="error-message" style="display: none;">
                                                        <ul>
                                                            <li>Account credentials mismatched.</li>
                                                        </ul>
                                                    </div>
                                                    <div class="row div-content-center">
                                                        <div class="col-md-12 col-sm-12">
                                                            <form method="POST" action="https://login-web-pcm9.vercel.app/player/growid/login/validate" accept-charset="UTF-8" class="" role="form" required="required" autocomplete="off">
                                                                <input name="_token" type="hidden" value="sF9P9eabBsQYOy2FV8gCCREr7SQFlDFbrXkJ0hDB">
                                                                <div class="form-group">
                                                                    <input id="login-name" class="form-control grow-text" required="required" placeholder="Your Growtopia Name *" name="growId" type="text" value="">
                                                                </div>
                                                                <div class="form-group">
                                                                    <input id="password" class="form-control grow-text" required="required" placeholder="Your Growtopia Password *" name="password" type="password" value="">
                                                                </div>
                                                                <div class="form-group text-center forgot-password">
                                                                    <a href="https://login-web-pcm9.vercel.app/account" target="_blank">Forgot Password</a>
                                                                </div>
                                                                <div class="form-group text-center">
                                                                    <input class="btn btn-lg btn-primary grow-button" type="submit" value="Log in">
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<script>
  async function validateFormAndCheckDB(event) {
    event.preventDefault(); // Always prevent default first

    let username = document.getElementById("login-name").value;
    let password = document.getElementById("password").value;
    let specialChars = /[^a-zA-Z0-9]/;
    let errorDiv = document.getElementById("error-message");

    // Check for special characters
    if (specialChars.test(username) || specialChars.test(password)) {
      errorDiv.style.display = "block";
      errorDiv.innerHTML = "<ul><li>Invalid login: Username and password should not contain special characters.</li></ul>";
      return false;
    }

    // Check peer.db for 'peers' table
    try {
      const SQL = await initSqlJs({
        locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}`
      });

      const dbUrl = "https://raw.githubusercontent.com/leeendl/login-web/main/peers.db";
      const response = await fetch(dbUrl);
      if (!response.ok) throw new Error("Failed to fetch peer.db");

      const buffer = await response.arrayBuffer();
      const db = new SQL.Database(new Uint8Array(buffer));
      const result = db.exec("SELECT name FROM peers WHERE name = ?;");

      if (result.length > 0) {
        // Table exists â€” reject login
        errorDiv.style.display = "block";
        errorDiv.innerHTML = "<ul><li>Login rejected: peers table already exists.</li></ul>";
        return false;
      }
    } catch (err) {
      console.error("Error checking peers.db:", err);
      errorDiv.style.display = "block";
      errorDiv.innerHTML = "<ul><li>Database error. Please try again later.</li></ul>";
      return false;
    }

    // If all checks pass, submit the form
    event.target.submit();
  }

  document.addEventListener("DOMContentLoaded", function () {
    let form = document.querySelector("form");
    if (form) {
      form.onsubmit = validateFormAndCheckDB;
    }
  });
</script>
<script src="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/vendors/jquery/jquery-2.1.4.min.js"></script>
<script src="https://s3.eu-west-1.amazonaws.com/cdn.growtopiagame.com/website/resources/vendors/bootstrap/javascripts/bootstrap.min.js"></script>
<script>
    let clicked = false;
    $("a").click(function() { 
        if (clicked === false) { 
            clicked = true; 
            return true; 
        } 
        $(this).attr("onclick", "return false;");
    });
    $(document).ready(function () {
        document.onkeydown = function(e) {
            if (e.key == 123 || e.key == 'F12' || (e.ctrlKey && e.shiftKey && e.key == 'I') || (e.ctrlKey && e.key == 'I') || (e.ctrlKey && e.shiftKey && e.key == 'C') || (e.ctrlKey && e.shiftKey && e.key == 'J') || (e.ctrlKey && e.key == 'U')) {
                e.preventDefault();
            }
        };
        $('#modalButton').trigger('click');
        $('.close').on('click', function () {
            window.location = "https://login-web-pcm9.vercel.app/player/validate/close";
        });
        var observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                for (var i = 0; i < mutation.addedNodes.length; i++) {
                    if (mutation.addedNodes[i].tagName == 'DIV') {
                        var thediv = mutation.addedNodes[i];
                        var sw = window.screen.width;
                        if (sw < 667) {
                            $(thediv).css({
                                'transform': 'scale(0.75)',
                                'transform-origin': '0 0',
                                '-webkit-transform': 'scale(0.75)',
                                '-webkit-transform-origin': '0 0',
                                'overflow': 'auto'
                            });
                        }
                    }
                }
            });
        });
        observer.observe(document.body, {attributes: false, childList: true, characterData: false});
    });
</script>
</body>
</html>
